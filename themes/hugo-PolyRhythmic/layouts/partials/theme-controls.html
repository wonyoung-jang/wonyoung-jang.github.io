<button class="component button icon theme-controls">
  <input type="checkbox" id="theme-controls"/>
  <label for="theme-controls" class="component button icon">
    <i class="icon">
      palette
    </i> 
  </label>
  
  <div class="component sheet side modal controls">
    <span class="theme-controls-title headline-medium">Theme controls</span>
    {{/*  Max char width toggle */}}
    <div id="max-width-selector-container">
      <div class="title-large">Content text width</div>
      
      <div class="set segmented-buttons">
        <label class="component button segmented start">
          <input type="radio" name="width" id="width-selector-60" value="60"/>
          <i class="icon">check</i>
          60ch
        </label>
        
        <label class="component button segmented">
          <input type="radio" name="width" id="width-selector-120" value="120"/>
          <i class="icon">check</i>
          120ch
        </label>
        
        <label class="component button segmented end">
          <input type="radio" name="width" id="width-selector-max" value="max"/>
          <i class="icon">check</i>
          Max
        </label>
      </div>
    </div>

    {{/*  Dim images in dark mode */}}
    <div id="dim-images-selector-container">
      <div class="title-large">Dim images (dark mode)</div>

      <label class="component switch both">
        <input type="checkbox" id="dim-image-selector">
        <span></span>
      </label>
    </div>

    {{/*  Tertiary color temperature */}}
    <div id="tertiary-temperature-selector-container">
      <div class="title-large">Tertiary temperature</div>

      <div class="set segmented-buttons">
        <label class="component button segmented start">
          <input type="radio" name="temperature" id="tertiary-selector-cool" value="cool"/>
          <i class="icon">check</i>
          Cooler
        </label>
        
        <label class="component button segmented end">
          <input type="radio" name="temperature" id="tertiary-selector-warm" value="warm"/>
          <i class="icon">check</i>
          Warmer
        </label>
      </div>

      <section class="color-temp-reference">
        <div id="primary">Primary</div>
        <div id="tertiary">Tertiary</div>
      </section>
    </div>

    {{/*  Colors  */}}
    <div id="color-selector-container">
      <label class="title-large" for="hue-selector">Hue</label>
      <div class="slider">
        <input type="range" id="hue-selector" min="0" max="360" value="302.8"/>
        <span class="tooltip" id="hue-tooltip"></span>
      </div>
      <div id="theme-hues"></div>
          
      <label class="title-large" for="chroma-selector">Chroma</label>
      <div class="slider">
        <input type="range" id="chroma-selector" min="0" max="100" value="58"/>
        <span class="tooltip" id="chroma-tooltip"></span>
      </div>
      <div id="theme-chromas"></div>
    </div>
      
    {{/*  Shape  */}}
    <div id="shape-selector-container">
      <label class="title-large" for="shape-selector">Shape</label>
      <div class="slider">
        <input type="range" id="shape-selector" min="0.0" max="4.0" value="1.7" step="0.05"/>
        <span class="tooltip" id="shape-tooltip"></span>
      </div>
    </div>
            
    {{/*  Typography  */}}
    <div id="font-size-selector-container">
      {{/*  Font size  */}}
      <label class="title-large" for="font-size-selector">Font Size</label>
      <div class="slider">
        <input type="range" id="font-size-selector" min="8" max="24" value="14" step="1">
        <span class="tooltip" id="font-size-tooltip">14px</span>
      </div>

      {{/*  Line height  */}}
      <label class="title-large" for="line-height-selector">Line Height</label>
      <div class="slider">
        <input type="range" id="line-height-selector" min="1" max="2.5" value="1.25" step="0.05">
        <span class="tooltip" id="line-height-tooltip">1.5</span>
      </div>
    </div>
  
    {{/*  Font families  */}}
    <div id="typography-selector-container">
      <div id="typography-selector">
        {{/*  Brand  */}}
        <fieldset class="typography-fieldset">
          <legend class="title-large">Brand font family</legend>
          <label class="component radio">
            <input type="radio" id="brand-raleway" name="brand-font" value="Raleway" checked>
            <span>Raleway</span>
          </label>
          <label class="component radio">
            <input type="radio" id="brand-times-new-roman" name="brand-font" value="Times New Roman">
            <span>Times New Roman</span>
          </label>
          <label class="component radio">
            <input type="radio" id="brand-times" name="brand-font" value="Times">
            <span>Times</span>
          </label>
          <label class="component radio">
            <input type="radio" id="brand-georgia" name="brand-font" value="Georgia">
            <span>Georgia</span>
          </label>
          <label class="component radio">
            <input type="radio" id="brand-palatino" name="brand-font" value="Palatino">
            <span>Palatino</span>
          </label>
          <label class="component radio">
            <input type="radio" id="brand-bookman" name="brand-font" value="Bookman">
            <span>Bookman</span>
          </label>
          <label class="component radio">
            <input type="radio" id="brand-garamond" name="brand-font" value="Garamond">
            <span>Garamond</span>
          </label>
          <label class="component radio">
            <input type="radio" id="brand-century-schoolbook" name="brand-font" value="Century Schoolbook">
            <span>Century Schoolbook</span>
          </label>
        </fieldset>
        
        <div class="example title-small">Example: Brand text</div>

        <hr class="divider">

        {{/*  Plain  */}}
        <fieldset class="typography-fieldset">
          <legend class="title-large">Plain font family</legend>
          <label class="component radio">
            <input type="radio" id="plain-ibm" name="plain-font" value="IBM Plex Sans" checked>
            <span>IBM Plex Sans</span>
          </label>
          <label class="component radio">
            <input type="radio" id="plain-arial" name="plain-font" value="Arial">
            <span>Arial</span>
          </label>
          </label>
          <label class="component radio">
            <input type="radio" id="plain-helvetica" name="plain-font" value="Helvetica">
            <span>Helvetica</span>
          </label>
          <label class="component radio">
            <input type="radio" id="plain-verdana" name="plain-font" value="Verdana">
            <span>Verdana</span>
          </label>
          <label class="component radio">
            <input type="radio" id="plain-tahoma" name="plain-font" value="Tahoma">
            <span>Tahoma</span>
          </label>
          <label class="component radio">
            <input type="radio" id="plain-arial-black" name="plain-font" value="Arial Black">
            <span>Arial Black</span>
          </label>
          <label class="component radio">
            <input type="radio" id="plain-comic-sans" name="plain-font" value="Comic Sans MS">
            <span>Comic Sans MS</span>
          </label>
          <label class="component radio">
            <input type="radio" id="plain-impact" name="plain-font" value="Impact">
            <span>Impact</span>
          </label>
          <label class="component radio">
            <input type="radio" id="plain-avant-garde" name="plain-font" value="Avant Garde">
            <span>Avant Garde</span>
          </label>
        </fieldset>

        <div class="example body-large">Example: Plain text</div>

        <hr class="divider">
        
        {{/*  Code  */}}
        <fieldset class="typography-fieldset">
          <legend class="title-large">Code font family</legend>
          <label class="component radio">
            <input type="radio" id="code-ibm" name="code-font" value="IBM Plex Mono" checked>
            <span>IBM Plex Mono</span>
          </label>
          <label class="component radio">
            <input type="radio" id="code-courier-new" name="code-font" value="Courier New">
            <span>Courier New</span>
          </label>
          <label class="component radio">
            <input type="radio" id="code-courier" name="code-font" value="Courier">
            <span>Courier</span>
          </label>
          <label class="component radio">
            <input type="radio" id="code-andale-mono" name="code-font" value="Andale Mono">
            <span>Andale Mono</span>
          </label>
          <label class="component radio">
            <input type="radio" id="code-consolas" name="code-font" value="Consolas">
            <span>Consolas</span>
          </label>
        </fieldset>

        <div class="example code-typeface">Example: Code text</div>

      </div>
    </div>
  </div>
</button>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    var root = document.documentElement;
    var widthSelector60 = document.getElementById("width-selector-60");
    var widthSelector120 = document.getElementById("width-selector-120");
    var widthSelectorMax = document.getElementById("width-selector-max");
    var dimImageSelector = document.getElementById("dim-image-selector");
    var tertiarySelectorCool = document.getElementById("tertiary-selector-cool");
    var tertiarySelectorWarm = document.getElementById("tertiary-selector-warm");
    var hueSelector = document.getElementById("hue-selector");
    var chromaSelector = document.getElementById("chroma-selector");
    var shapeSelector = document.getElementById("shape-selector");
    var typographySelector = document.getElementById('typography-selector');
    var fontSizeSelector = document.getElementById('font-size-selector');
    var lineHeightSelector = document.getElementById('line-height-selector');

    // Load saved values from localStorage
    var savedWidth = localStorage.getItem("max-char-width");
    var savedDimImages = localStorage.getItem("dim-images");
    var savedTemperature = localStorage.getItem("tertiary-temperature");
    var savedHue = localStorage.getItem("theme-hue");
    var savedChroma = localStorage.getItem("theme-chroma");
    var savedShape = localStorage.getItem("theme-shape");
    var savedBrandFont = localStorage.getItem('typography-brand-font');
    var savedPlainFont = localStorage.getItem('typography-plain-font');
    var savedCodeFont = localStorage.getItem('typography-code-font');
    var savedFontSize = localStorage.getItem('typography-font-size');
    var savedLineHeight = localStorage.getItem('typography-line-height');

    if (savedWidth !== null) {
      if (savedWidth === "60") {
        widthSelector60.checked = true;
      } else if (savedWidth === "120") {
        widthSelector120.checked = true;
      } else if (savedWidth === "max") {
        widthSelectorMax.checked = true;
      }
    } else {
      widthSelector60.checked = true;
      localStorage.setItem("max-char-width", "60");
    }

    if (savedDimImages !== null) {
      dimImageSelector.checked = savedDimImages === "true";
    } else {
      dimImageSelector.checked = false;
      localStorage.setItem("dim-images", "0.8");
    }

    if (savedTemperature !== null) {
      if (savedTemperature === "cool") {
        tertiarySelectorCool.checked = true;
      } else if (savedTemperature === "warm") {
        tertiarySelectorWarm.checked = true;
      }
    } else {
      tertiarySelectorCool.checked = true;
      localStorage.setItem("tertiary-temperature", "cool");
    }
    

    if (savedHue !== null) {
      hueSelector.value = savedHue;
    } else {
      hueSelector.value = 305;
      localStorage.setItem("theme-hue", 305);
    }

    if (savedChroma !== null) {
      chromaSelector.value = savedChroma;
    } else {
      chromaSelector.value = 55;
      localStorage.setItem("theme-chroma", 55);
    }

    if (savedShape !== null) {
      shapeSelector.value = savedShape;
    } else {
      shapeSelector.value = 4;
      localStorage.setItem("theme-shape", 4);
    }

    if (savedBrandFont) document.querySelector(`input[name="brand-font"][value="${savedBrandFont}"]`).checked = true;
    if (savedPlainFont) document.querySelector(`input[name="plain-font"][value="${savedPlainFont}"]`).checked = true;
    if (savedCodeFont) document.querySelector(`input[name="code-font"][value="${savedCodeFont}"]`).checked = true;

    if (savedFontSize !== null) {
      fontSizeSelector.value = savedFontSize;
    } else {
      fontSizeSelector.value = 16;
      localStorage.setItem("typography-font-size", 16);
    }

    if (savedLineHeight !== null) {
      lineHeightSelector.value = savedLineHeight;
    } else {
      lineHeightSelector.value = 1.5;
      localStorage.setItem("typography-line-height", 1.5);
    }

    function updateWidth() {
      var width = document.querySelector('input[name="width"]:checked').value;

      if (width === "60") {
        root.style.setProperty("--input-char-width", width + "ch");
      } else if (width === "120") {
        root.style.setProperty("--input-char-width", width + "ch");
      } else if (width === "max") {
        root.style.setProperty("--input-char-width", "100%");
      }

      localStorage.setItem("max-char-width", width);
    }

    function updateDimImages() {
      var dimImages = dimImageSelector.checked ? "0.8" : "1";

      root.style.setProperty("--input-dim-image", dimImages);
      
      localStorage.setItem("dim-images", dimImages);
    }

    function updateTemperature() {
      var temperature = document.querySelector('input[name="temperature"]:checked').value;

      if (temperature === "cool") {
        root.style.setProperty("--input-tertiary-temperature", "-1");
      } else if (temperature === "warm") {
        root.style.setProperty("--input-tertiary-temperature", "1");
      }
      
      localStorage.setItem("tertiary-temperature", temperature);
    }

    function updateColor() {
      var hue = hueSelector.value;
      var chroma = chromaSelector.value;

      root.style.setProperty("--input-color-hue", hue + "deg");
      root.style.setProperty("--input-color-chroma", chroma);
      
      localStorage.setItem("theme-hue", hue);
      localStorage.setItem("theme-chroma", chroma);
    }

    function updateShape() {
      var shape = shapeSelector.value;

      root.style.setProperty("--input-shape-corner", shape + "px");
      
      localStorage.setItem("theme-shape", shape);
    }

    function updateTypography() {
      var brandFont = document.querySelector('input[name="brand-font"]:checked').value;
      var plainFont = document.querySelector('input[name="plain-font"]:checked').value;
      var codeFont = document.querySelector('input[name="code-font"]:checked').value;
      var fontSize = fontSizeSelector.value;
      var lineHeight = lineHeightSelector.value;

      root.style.setProperty('--typeface-brand', brandFont);
      root.style.setProperty('--typeface-plain', plainFont);
      root.style.setProperty('--typeface-code', codeFont);
      root.style.setProperty('--input-font-size', fontSize + 'px');
      root.style.setProperty('--input-line-height', lineHeight + 'rem');

      localStorage.setItem('typography-brand-font', brandFont);
      localStorage.setItem('typography-plain-font', plainFont);
      localStorage.setItem('typography-code-font', codeFont);
      localStorage.setItem('typography-font-size', fontSize);
      localStorage.setItem('typography-line-height', lineHeight);
    }

    // Apply saved or default values
    updateWidth();
    updateDimImages();
    updateTemperature();
    updateColor();
    updateShape();
    updateTypography();

    // Event listeners
    widthSelector60.addEventListener("change", updateWidth);
    widthSelector120.addEventListener("change", updateWidth);
    widthSelectorMax.addEventListener("change", updateWidth);
    dimImageSelector.addEventListener("change", updateDimImages);
    tertiarySelectorCool.addEventListener("change", updateTemperature);
    tertiarySelectorWarm.addEventListener("change", updateTemperature);
    hueSelector.addEventListener("input", updateColor);
    chromaSelector.addEventListener("input", updateColor);
    shapeSelector.addEventListener("input", updateShape);
    fontSizeSelector.addEventListener('input', updateTypography);
    lineHeightSelector.addEventListener('input', updateTypography);
    typographySelector.addEventListener('change', updateTypography);
  });

  // Slider tooltips
  const rangeInputHues = document.getElementById('hue-selector');
  const tooltipHues = document.getElementById('hue-tooltip');
  const rangeInputChromas = document.getElementById('chroma-selector');
  const tooltipChromas = document.getElementById('chroma-tooltip');
  const rangeInputShape = document.getElementById('shape-selector');
  const tooltipShape = document.getElementById('shape-tooltip');
  const rangeInputFontSize = document.getElementById('font-size-selector');
  const tooltipFontSize = document.getElementById('font-size-tooltip');
  const rangeInputLineHeight = document.getElementById('line-height-selector');
  const tooltipLineHeight = document.getElementById('line-height-tooltip');

  function updateTooltipHues(value) {
      tooltipHues.textContent = value;
      const thumbPosition = (value - rangeInputHues.min) / (rangeInputHues.max - rangeInputHues.min);
      const tooltipPositionHues = thumbPosition * (rangeInputHues.offsetWidth - 20) + 10;
      tooltipHues.style.left = `${tooltipPositionHues}px`;
      tooltipHues.style.opacity = '1';
  }

  function updateTooltipChromas(value) {
    tooltipChromas.textContent = value;
    const thumbPosition = (value - rangeInputChromas.min) / (rangeInputChromas.max - rangeInputChromas.min);
    const tooltipPositionChromas = thumbPosition * (rangeInputChromas.offsetWidth - 20) + 10;
    tooltipChromas.style.left = `${tooltipPositionChromas}px`;
    tooltipChromas.style.opacity = '1';
  }

  function updateTooltipShape(value) {
    tooltipShape.textContent = value;
    const thumbPositionShape = (value - rangeInputShape.min) / (rangeInputShape.max - rangeInputShape.min);
    const tooltipShapePosition = thumbPositionShape * (rangeInputShape.offsetWidth - 20) + 10;
    tooltipShape.style.left = `${tooltipShapePosition}px`;
    tooltipShape.style.opacity = '1';
  }

  function updateTooltipFontSize(value) {
    tooltipFontSize.textContent = value + 'px';
    const thumbPositionFontSize = (value - rangeInputFontSize.min) / (rangeInputFontSize.max - rangeInputFontSize.min);
    const tooltipFontSizePosition = thumbPositionFontSize * (rangeInputFontSize.offsetWidth - 20) + 10;
    tooltipFontSize.style.left = `${tooltipFontSizePosition}px`;
    tooltipFontSize.style.opacity = '1';
  }

  function updateTooltipLineHeight(value) {
    tooltipLineHeight.textContent = value;
    const thumbPositionLineHeight = (value - rangeInputLineHeight.min) / (rangeInputLineHeight.max - rangeInputLineHeight.min);
    const tooltipLineHeightPosition = thumbPositionLineHeight * (rangeInputLineHeight.offsetWidth - 20) + 10;
    tooltipLineHeight.style.left = `${tooltipLineHeightPosition}px`;
    tooltipLineHeight.style.opacity = '1';
  }

  rangeInputHues.addEventListener('input', (e) => {
      updateTooltipHues(e.target.value);
  });

  rangeInputHues.addEventListener('mousedown', () => {
      updateTooltipHues(rangeInputHues.value);
  });

  rangeInputHues.addEventListener('mouseup', () => {
      tooltipHues.style.opacity = '0';
  });

  rangeInputHues.addEventListener('mouseleave', () => {
      tooltipHues.style.opacity = '0';
  });

  rangeInputChromas.addEventListener('input', (e) => {
      updateTooltipChromas(e.target.value);
  });

  rangeInputChromas.addEventListener('mousedown', () => {
      updateTooltipChromas(rangeInputChromas.value);
  });

  rangeInputChromas.addEventListener('mouseup', () => {
      tooltipChromas.style.opacity = '0';
  });

  rangeInputChromas.addEventListener('mouseleave', () => {
      tooltipChromas.style.opacity = '0';
  });

  rangeInputShape.addEventListener('input', (e) => {
      updateTooltipShape(e.target.value);
  });

  rangeInputShape.addEventListener('mousedown', () => {
      updateTooltipShape(rangeInputShape.value);
  });

  rangeInputShape.addEventListener('mouseup', () => {
      tooltipShape.style.opacity = '0';
  });

  rangeInputShape.addEventListener('mouseleave', () => {
      tooltipShape.style.opacity = '0';
  });

  rangeInputFontSize.addEventListener('input', (e) => {
      updateTooltipFontSize(e.target.value);
  });

  rangeInputFontSize.addEventListener('mousedown', () => {
      updateTooltipFontSize(rangeInputFontSize.value);
  });

  rangeInputFontSize.addEventListener('mouseup', () => {
      tooltipFontSize.style.opacity = '0';
  });

  rangeInputFontSize.addEventListener('mouseleave', () => {
      tooltipFontSize.style.opacity = '0';
  });

  rangeInputLineHeight.addEventListener('input', (e) => {
      updateTooltipLineHeight(e.target.value);
  });

  rangeInputLineHeight.addEventListener('mousedown', () => {
      updateTooltipLineHeight(rangeInputLineHeight.value);
  });

  rangeInputLineHeight.addEventListener('mouseup', () => {
      tooltipLineHeight.style.opacity = '0';
  });

  rangeInputLineHeight.addEventListener('mouseleave', () => {
      tooltipLineHeight.style.opacity = '0';
  });
</script>