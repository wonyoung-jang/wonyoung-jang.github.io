<button class="component button icon-button" id="theme-selector">
  <i>palette</i>
  <menu class="menu">
    <label class="title-large" for="hue-selector">Hue</label>
    <div class="slider">
      <input type="range" id="hue-selector" min="0" max="360" value="302.8"/>
      <span class="tooltip" id="hue-tooltip"></span>
    </div>
    <div id="theme-hues"></div>
    
    <div class="divider"></div>
    
    <label class="title-large" for="chroma-selector">Chroma</label>
    <div class="slider">
      <input type="range" id="chroma-selector" min="0" max="100" value="58"/>
      <span class="tooltip" id="chroma-tooltip"></span>
    </div>
    <div id="theme-chromas"></div>
  </menu>
</button>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    var hueSelector = document.getElementById("hue-selector");
    var chromaSelector = document.getElementById("chroma-selector");
    var root = document.documentElement;

    function updateColor() {
      var hue = hueSelector.value;
      var chroma = chromaSelector.value;
      root.style.setProperty("--input-color-hue", hue + "deg");
      root.style.setProperty("--input-color-chroma", chroma);
      
      // Store values in localStorage
      localStorage.setItem("theme-hue", hue);
      localStorage.setItem("theme-chroma", chroma);
    }

    // Load saved values from localStorage
    var savedHue = localStorage.getItem("theme-hue");
    var savedChroma = localStorage.getItem("theme-chroma");

    if (savedHue !== null) {
      hueSelector.value = savedHue;
    }
    if (savedChroma !== null) {
      chromaSelector.value = savedChroma;
    }

    // Apply saved or default values
    updateColor();

    hueSelector.addEventListener("input", updateColor);
    chromaSelector.addEventListener("input", updateColor);
  });

  const rangeInput = document.getElementById('hue-selector');
  const tooltip = document.getElementById('hue-tooltip');
  const rangeInputChromas = document.getElementById('chroma-selector');
  const tooltipChromas = document.getElementById('chroma-tooltip');

  function updateTooltip(value) {
      tooltip.textContent = value;
      const thumbPosition = (value - rangeInput.min) / (rangeInput.max - rangeInput.min);
      const tooltipPosition = thumbPosition * (rangeInput.offsetWidth - 20) + 10;
      tooltip.style.left = `${tooltipPosition}px`;
      tooltip.style.opacity = '1';
  }

  rangeInput.addEventListener('input', (e) => {
      updateTooltip(e.target.value);
  });

  rangeInput.addEventListener('mousedown', () => {
      updateTooltip(rangeInput.value);
  });

  rangeInput.addEventListener('mouseup', () => {
      tooltip.style.opacity = '0';
  });

  rangeInput.addEventListener('mouseleave', () => {
      tooltip.style.opacity = '0';
  });

  function updateTooltipChromas(value) {
      tooltipChromas.textContent = value;
      const thumbPosition = (value - rangeInputChromas.min) / (rangeInputChromas.max - rangeInputChromas.min);
      const tooltipPositionChromas = thumbPosition * (rangeInputChromas.offsetWidth - 20) + 10;
      tooltipChromas.style.left = `${tooltipPositionChromas}px`;
      tooltipChromas.style.opacity = '1';
  }

  rangeInputChromas.addEventListener('input', (e) => {
      updateTooltipChromas(e.target.value);
  });

  rangeInputChromas.addEventListener('mousedown', () => {
      updateTooltipChromas(rangeInputChromas.value);
  });

  rangeInputChromas.addEventListener('mouseup', () => {
      tooltipChromas.style.opacity = '0';
  });

  rangeInputChromas.addEventListener('mouseleave', () => {
      tooltipChromas.style.opacity = '0';
  });
</script>