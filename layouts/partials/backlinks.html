{{ $re := $.File.BaseFileName }}
{{ $backlinks := slice }}
{{ range where .Site.RegularPages "Type" "pages" }}
   {{ if and (findRE $re .RawContent) (not (eq $re .File.BaseFileName)) }}
      {{ $backlinks = $backlinks | append . }}
   {{ end }}
{{ end }}

<hr>
{{ if gt (len $backlinks) 0 }}
  <aside>
    <h3>Linked From These Notes</h3>
    <div class="backlinks">
        <ul>
          {{ range $backlinks }}
              <p class="capitalize"><a style="color: var(--link);" href="{{ .RelPermalink }}">{{ .Title }}</a></p>
          {{ end }}
        </ul>
    </div>
  </aside>
{{ end }}

<br>
<aside class="related">
  {{ $related := .Site.RegularPages.Related . | complement $backlinks | first 3 -}}
  {{ with $related -}}
    <h3>Related Pages</h3>
    <ul>
      {{ range . -}}
        <p class="capitalize"><a style="color: var(--link);" href="{{ .RelPermalink }}">{{ .Title }}</a></p>
      {{ end -}}
    </ul>
  {{ end -}}
</aside>