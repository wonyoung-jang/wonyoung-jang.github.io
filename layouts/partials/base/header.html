{{/* Top App Bar */}}
<nav class="component top-app-bar center small" aria-label="Top App Bar">
    {{- /* Headline */ -}}
    {{- if .Site.Title }}
        <section class="start">
            {{/* Site ID */}}
            {{ partial "components/siteid-button.html" . }}

            {{/* LANGUAGE SWITCH 
            {{- $lang := .Lang}}
            {{- with $.Site.Home.AllTranslations }}
                <ul class="lang-switch">
                    {{- range . -}}
                        {{- if ne $lang .Lang }}
                            <a  href="{{- .Permalink -}}" 
                                title="{{ .Language.Params.languageAltTitle | default (.Language.LanguageName | emojify) | default (.Lang | title) }}"
                                aria-label="{{ .Language.LanguageName | default (.Lang | title) }}">
                                
                                {{- if (and $.Site.Params.displayFullLangName (.Language.LanguageName)) }}
                                    {{- .Language.LanguageName | emojify -}}
                                {{- else }}
                                    {{- .Lang | title -}}
                                {{- end -}}

                            </a>
                        {{- end -}}
                    {{- end}}
                </ul>
            {{- end }}
            */}}

        </section>
    {{- end }}

    {{/* End section: Buttons */}}
    <section class="end">
        {{/* Theme */}}
        {{ partial "components/theme-button.html" . }}        
        
        {{/* Random */}}
        {{ partial "components/random-button.html" . }}
        
        {{/* Search */}}
        {{ partial "components/search-button.html" . }}
    </section>
</nav>

{{/* Tabs */}}
<div class="component tabs title-medium">
    {{ define "menu-item" }}   
        {{ $page := .page }}
        {{ with .entry }}
            {{ if .HasChildren }}
                {{ if or ($page.IsMenuCurrent "main" .) ($page.HasMenuCurrent "main" .) }}
                    <li class="component tab active">
                        <a href="{{ .URL }}"></a>
                        {{ .Name }}

                        <section class="sub-menu">
                            {{ range .Children }}
                                {{ template "menu-item" (dict "entry" . "page" $page) }}
                            {{ end }}
                        </section>

                    </li>
                {{ else }}
                    <li class="component tab">
                        <a href="{{ .URL }}"></a>
                        {{ .Name }}

                        <section class="sub-menu">
                            {{ range .Children }}
                                {{ template "menu-item" (dict "entry" . "page" $page) }}
                            {{ end }}
                        </section>
                    </li>
                {{ end }}
            {{ else }}
                {{ if $page.IsMenuCurrent "main" . }}
                    <li class="component tab active">
                        <a href="{{ .URL }}"></a>
                        {{ .Name }}
                    </li>

                {{ else }}
                    <li class="component tab">
                        <a href="{{ .URL }}"></a>
                        {{ .Name }}
                    </li>

                {{ end }}
            {{ end }}
        {{ end }}
    {{ end }}
    
    <div class="component tabs">
        {{ $page := . }}
        {{ range .Site.Menus.main }}
            {{ template "menu-item" (dict "entry" . "page" $page) }}
        {{ end }}
    </div>
</div>

{{- /* Theme-toggle is enabled */}}
{{- if (not .Site.Params.disableThemeToggle) }}

    {{- /* Theme is light */}}
    {{- if (eq .Site.Params.defaultTheme "light") }}
        <script>
            if (localStorage.getItem("pref-theme") === "dark") {
                document.body.classList.add('dark');
            }
        </script>

    {{- /* Theme is dark */}}
    {{- else if (eq .Site.Params.defaultTheme "dark") }}
        <script>
            if (localStorage.getItem("pref-theme") === "light") {
                document.body.classList.remove('dark')
            }
        </script>

    {{- /* Theme is auto */}}
    {{- else }}
        <script>
            if (localStorage.getItem("pref-theme") === "dark") {
                document.body.classList.add('dark');
            } else if (localStorage.getItem("pref-theme") === "light") {
                document.body.classList.remove('dark')
            } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark');
            }
        </script>
    {{- end }}

{{- /* Theme-toggle is disabled and theme is auto */}}
{{- else if (and (ne .Site.Params.defaultTheme "light") (ne .Site.Params.defaultTheme "dark"))}}
    <script>
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.body.classList.add('dark');
        }
    </script>
    
{{- end }}